# vi:et:ts=2 sw=2 sts=2
image: pidgin/builder-debian:buster
pipelines:
  default:
    - step:
        script:
          - set -ex
          - hg clone https://bitbucket.org/pidgin/talkatu
          - meson -Dprefix=/usr talkatu talkatu/build
          - ninja -C talkatu/build install
          - ldconfig
          - meson -Dsilc=false -Ddoc=true -Ddebug=true build-pipelines
          - ninja -C build-pipelines
          - ninja -C build-pipelines test
  branches:
    release-2.x.y:
      - step:
          image: pidgin/release-builder:release-2.x.y
          script:
            - set -ex
            - ./autogen.sh --enable-debug
            - make -s -j$(nproc)
            - make -s -j$(nproc) check
            - make distcheck
